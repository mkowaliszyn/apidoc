@(tpl: models.MainTemplate,
  service: com.gilt.apidocspec.models.Service,
  isWatching: Boolean
)(implicit flash: Flash)

@main(tpl) {

  @tpl.service.map { svc =>
    <div class="pull-right">
      @if(tpl.isOrgMember) {
        <a href="@routes.Versions.create(orgKey = tpl.org.get.key, service = Some(svc.key))">Upload new version</a> |
      }

      @if(isWatching) {
        <a class="postForm" href="@routes.Versions.postWatch(orgKey = tpl.org.get.key, serviceKey = svc.key, version = tpl.version.get)">Watching</a>
      } else {
        <a class="postForm" href="@routes.Versions.postWatch(orgKey = tpl.org.get.key, serviceKey = svc.key, version = tpl.version.get)">Not Watching</a>
      }
    </div>
  }

  <div class="pull-left">
    @service.description.getOrElse("")

    <h2>Headers</h2>
    @if(service.headers.isEmpty) {
      <em>No headers</em>
    } else {
      @headers(tpl.org.get, tpl.service.get, tpl.version.get, service, service.headers)
    }

    <h2>Resources</h2>
    @service.resources.map { case (modelName, resource) =>
      <div id="resource-@lib.UrlKey.generate(modelName)"></div>
      <a name="resource-@lib.UrlKey.generate(modelName)"></a>
      <div class="version_resource">
        <h3><a href="#model-@lib.UrlKey.generate(modelName)">@modelName</a></h3>

        @resource.description.getOrElse("")

        <h4>Operations</h4>
        @if(resource.operations.isEmpty) {
          <em>No operations</em>
        } else {
          <table class="table table-hover table-condensed">
            <thead>
              <tr>
                <th colspan="2">Method and Path</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
             @resource.operations.zipWithIndex.map { case(operation, index) =>
               <tr>
                 <td class="nowrap"><a onClick="$('#operation-@lib.UrlKey.generate(modelName)-@index').toggle()">@operation.method</a></td>
                 <td class="nowrap"><a onClick="$('#operation-@lib.UrlKey.generate(modelName)-@index').toggle()">@operation.path</a></td>
                 <td>@operation.description.getOrElse("")</td>
               </tr>
               <tr id="operation-@lib.UrlKey.generate(modelName)-@index" style="display:none">
                 <td></td>
                 <td colspan="2">
                   @operation.method @service.baseUrl@operation.path

                   @operation.body.map { b =>
                     <h4>Body</h4>
                     @body(tpl.org.get, tpl.service.get, tpl.version.get, service, b)
                   }

                   <h4>Parameters</h4>
                   @if(operation.parameters.isEmpty) {
                     <em>No parameters</em>
                   } else {
                     @parameters(tpl.org.get, tpl.service.get, tpl.version.get, service, operation)
                   }

                   <h4>Response</h4>
                   @operation.responses.map { case (code, response) =>

                     <p>
                       HTTP @code:
                       @datatype(tpl.org.get, tpl.service.get, tpl.version.get, service, response.`type`)
                     </p>
                   }
                 </td>

               </tr>
             }
            </tbody>
          </table>
        }

      </div>
    }

    <h2>Enums</h2>
    @if(service.enums.isEmpty) {
      <em>None</em>
    } else {
      @service.enums.map { case (enumName, enum) =>
        <div id="enum-@lib.UrlKey.generate(enumName)"></div>
        <a name="enum-@lib.UrlKey.generate(enumName)"></a>
        <div class="version_model">
          <h3>@enumName</h3>

          @enum.description.getOrElse("")

          @values(tpl.org.get, tpl.service.get, tpl.version.get, enum)
        </div>
      }
    }

    <h2>Models</h2>
    @if(service.models.isEmpty) {
      <em>None</em>
    } else {
      @service.models.map { case (modelName, model) =>
        <div id="model-@lib.UrlKey.generate(modelName)"></div>
        <a name="model-@lib.UrlKey.generate(modelName)"></a>
        <div class="version_model">
          <h3>@modelName</h3>

          @model.description.getOrElse("")

          @fields(tpl.org.get, tpl.service.get, tpl.version.get, service, model.fields)
        </div>
      }
    </div>
  }

}
